# =========================================================================
# THE RUINA (THE RUIN) DISASTER
# (XVII ст.: 1657–1687 р.р. та відгомін у XVIII ст.)
# =========================================================================
#
# HISTORICAL BACKGROUND:
# The Ruina (Руїна, meaning "The Ruin") was a catastrophic period of inter-elite 
# warfare, foreign intervention, and mass depopulation (1657–1687) that followed
# Bohdan Khmelnytsky's death in 1657. The Hetmanate was fractured into:
# - Right Bank (under Polish rule): Doroshenko, Samoylovych, factions backed by Poland/Ottomans
# - Left Bank (under Moscow): Samoylovych, Samoylenko, Russian-backed khans
# - Foreign opportunists: Crimean Khans raiding for slaves; Ottoman armies seeking tribute;
#   Polish magnates claiming Ukrainian estates; Muscovite forces extending control
#
# Key Figures and Phases:
# - Ivan Mazepa (1639-1709): Brilliant but conflicted hetman who ruled 1687-1709,
#   attempts centralization but is ultimately loyal to Moscow (until 1708)
# - Ivan Vyhovsky (1609-1664): Right-Bank hetman, negotiates Hadyach Union (1658)
#   with Poland for Ukrainian autonomy but is defeated by Left-Bank rivals
# - Petro Doroshenko (1627-1698): Right-Bank warlord, shifts allegiance between Poland,
#   Ottomans, and Russia; symbol of chaotic instability
# - Yuri Khmelnytsky (1641-1682): Son of Bogdan, weak ruler, dominated by starshyna factions
#   and foreign powers
# - Ivan Samoylovych (1633-1690): Left-Bank hetman, allied with Moscow, outlasts rivals
#
# Structural Causes:
# - Hetman electoral system: Office elective, not hereditary → rival candidates backed by foreign powers
# - Starshyna power: Officer class (generals, koshivyy otaman, clerk) has veto-like influence
# - Autonomy vs. overlord pressure: Hetmanate nominally autonomous but increasingly pressured by Poland/Moscow
# - Economics of devastation: Constant warfare destroys agriculture, depopulates villages,
#   drives peasants to brigandage (opryshky) or Sich recruitment
# - Territorial fragmentation: Right/Left Bank split creates mirror governments, mutual raids
#
# Catastrophic Consequences:
# - Population loss: Estimated 25–40% of Hetmanate population died or fled
# - Depopulation of Right Bank: Many Ukrainians cross Dnieper to Left Bank or Ottoman lands
# - Peasant flight: Serfs and free peasants move to Sich, Crimea, or Polish/Ottoman territories
# - Religious polarization: Catholic vs. Orthodox polemics weaponized by rival factions
# - Economic collapse: Trade disrupted, salt mines damaged, agriculture subsistence-level
# - Cultural trauma: Ruina becomes archetypal memory in Ukrainian consciousness—symbol of
#   national fragmentation and foreign domination
#
# End of Ruina:
# - 1687: Moscow-backed Ivan Mazepa becomes hetman, promises stability
# - 1690s: Some recovery as Mazepa centralizes and modernizes administration
# - 1709: Mazepa defection to Swedes → battle of Poltava → Russian triumph → Ruina's formal end
#
# GAME MECHANICS (Design Notes):
# This disaster simulates mid-to-late game chaos for Ukrainian Cossack states (CHR, HET, 
# KIE, PRL, VOL). It triggers on instability (civil war, weak hetman, enemy pressure) and 
# remains active until stability is restored AND foreign interference reduced.
#
# Mechanics: Mid-game disaster for Ukrainian Cossack states (CHR, HET, KIE, PRL, VOL) 
# that simulates the devastating civil war period of 1657-1687. Drains tax, manpower, 
# and reform progress while causing unrest, pretender rebellions, and foreign intervention
# until stability, war exhaustion, loans, and devastation are brought back under control.
# Players mitigate damage through fortifications, diplomatic compromises, and foreign alliances.
#
# Narrative: Recreates the Ruina (1657–1687) when Ukrainian lands were torn between 
# competing hetmans, Polish magnates, Muscovite tsars, Crimean khans, and Ottoman sultans,
# resulting in mass depopulation, devastated provinces, and the partition of Ukraine.
#
# References: 
# - Serhii Plokhy, *The Cossacks and Religion in Early Modern Ukraine* (2001)
# - Zenon Kohut, *Russian Centralism and Ukrainian Autonomy* (1988)
# - Frank Sysyn, *Between Poland and the Ukraine* (1985)
# - Orest Subtelny, *The Mazepists* (1981)
# - Mykhailo Hrushevsky, *History of Ukraine-Rus'*, vols. 8-9
# - Bohdan Baranowski, *Obraz Rusi w Polsce XVI-XVII wieku* (2010)
# =========================================================================
chernihiv_ruina = {

	potential = {
		OR = {
			tag = CHR
			tag = HET
			tag = KIE
			tag = PRL
			tag = VOL
			tag = ZAZ
		}
		normal_or_historical_nations = yes
		NOT = { has_country_flag = survived_the_ruina }
	}

	can_start = {
		has_any_disaster = no
		OR = {
			current_age = age_of_reformation
			current_age = age_of_absolutism
		}
		is_year = 1657
		NOT = { is_year = 1700 }
		stability < 1
		OR = {
			war_exhaustion = 4
			num_of_loans = 4
			any_owned_province = {
				is_state_core = ROOT
				devastation = 15
			}
			AND = {
				is_subject = yes
				NOT = { liberty_desire = 50 }
			}
		}
		OR = {
			any_neighbor_country = {
				OR = {
					tag = POL
					tag = MOS
					tag = RUS
					tag = CRI
					tag = TUR
				}
				is_rival = ROOT
			}
			is_in_war = {
				defenders = ROOT
			}
		}
	}
	on_start = ruina_events.1

	can_stop = {
		has_any_disaster = yes
	}

	modifier = {
		global_unrest = 3
		manpower_recovery_speed = -0.25
		global_tax_modifier = -0.15
		reform_progress_growth = -0.25
		stability_cost_modifier = 0.35
		legitimacy = -1
		republican_tradition = -0.5
		war_exhaustion_cost = 0.25
	}

	progress = {
		modifier = {
			factor = 1.5
			always = yes
		}
		modifier = {
			factor = 2
			war_exhaustion = 6
		}
		modifier = {
			factor = 1.5
			num_of_loans = 7
		}
		modifier = {
			factor = 1.5
			any_owned_province = {
				is_state_core = ROOT
				devastation = 30
			}
		}
		modifier = {
			factor = 1.3
			NOT = { manpower_percentage = 0.3 }
		}
		modifier = {
			factor = 1.3
			is_subject = yes
			liberty_desire = 50
		}
		modifier = {
			factor = 1.2
			num_of_rebel_armies = 1
		}
		modifier = {
			factor = 0.75
			stability = 1
		}
		modifier = {
			factor = 0.5
			stability = 2
		}
		modifier = {
			factor = 0.3
			stability = 3
		}
		modifier = {
			factor = 0.8
			has_country_modifier = chr_baturyn_fortifications
		}
		modifier = {
			factor = 0.75
			has_country_modifier = chr_starshyna_compromise
		}
		modifier = {
			factor = 0.7
			alliance_with = POL
		}
		modifier = {
			factor = 0.7
			alliance_with = MOS
		}
		modifier = {
			factor = 0.7
			alliance_with = RUS
		}
	}

	can_end = {
		stability = 1
		NOT = { war_exhaustion = 2 }
		NOT = { num_of_loans = 3 }
		NOT = {
			any_owned_province = {
				is_state_core = ROOT
				devastation = 10
			}
		}
		NOT = { num_of_rebel_armies = 1 }
	}
	on_end = ruina_events.2

	on_monthly = {
		random_events = {
			100 = ruina_events.3
			100 = ruina_events.4
			50 = ruina_events.5
		}
	}
}
